language: node_js
node_js:
  - 8.10
python:
  - "2.7"
  - "3.6"

sudo: false

install: true

env:
  global:
  - access_key_id: $access_key_id
  - secret_access_key: $secret_access_key
  - region: us-east-1

script:
  - pip install --user awscli
  - aws configure set aws_access_key_id $access_key_id
  - aws configure set aws_secret_access_key $secret_access_key
  - aws configure set default.region us-east-1
  - export PATH=$PATH:$HOME/.local/bin
  - pwd
  - cd webapp
  - npm install aws-sdk
  - ls -al
  - cd node_modules
  - ls -al
  - cd ../../
  - ls -al

after_success:
  - pwd
  - ls -al
  - mkdir codedeploy_artifact
  - cd webapp
  - zip -r csye6225-lambda-${TRAVIS_JOB_NUMBER}.zip node_modules lambda.js
  - ls -al
  - cd ..
  - mv webapp/csye6225-lambda-${TRAVIS_JOB_NUMBER}.zip .
  - ls -al
  - pwd
  - filename=csye6225-lambda-${TRAVIS_JOB_NUMBER}.zip
  - aws lambda update-function-code --zip-file=fileb://${filename} --region=us-east-1 --function-name=HelloWorld
